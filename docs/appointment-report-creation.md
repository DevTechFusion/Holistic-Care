# Appointment Report Creation

This document explains how to create reports automatically when creating appointments.

## Overview

The system now supports creating reports automatically when creating appointments. This feature allows you to generate reports with appointment data in a single API call. The report will automatically use the appointment's data, eliminating the need for duplicate fields.

## API Usage

### Creating an Appointment with Report

To create an appointment and automatically generate a report, simply add the `create_report` flag to your appointment creation request:

```json
POST /api/appointments
{
    "date": "2024-01-15",
    "time_slot": "10:00",
    "patient_name": "John Doe",
    "contact_number": "1234567890",
    "agent_id": 1,
    "doctor_id": 1,
    "procedure_id": 1,
    "category_id": 1,
    "department_id": 1,
    "source_id": 1,
    "amount": 1000.00,
    "payment_mode": "cash",
    "notes": "Regular checkup",
    "mr_number": "MR123456",
    "remarks_1_id": 1,
    "remarks_2_id": 1,
    "status_id": 1,
    
    // Report creation flag
    "create_report": true
}
```

### Report Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `create_report` | boolean | No | Set to `true` to create a report with the appointment |

### Automatic Data Mapping

When `create_report` is set to `true`, the system automatically creates a report using the appointment's data:

- **Report Type**: Always set to "appointment_summary"
- **Report Amount**: Uses `appointment.amount`
- **Report Payment Method**: Uses `appointment.payment_mode`
- **Report Notes**: Uses `appointment.notes`
- **Report Remarks1**: Uses `appointment.remarks_1_id`
- **Report Remarks2**: Uses `appointment.remarks_2_id`
- **Report Status**: Uses `appointment.status_id`
- **Report Generated By**: Uses `appointment.agent_id`

### Response

When a report is created along with the appointment, the response will include:

```json
{
    "status": "success",
    "message": "Appointment created successfully and report generated",
    "data": {
        "id": 1,
        "date": "2024-01-15",
        "time_slot": "10:00",
        "patient_name": "John Doe",
        // ... other appointment fields
    }
}
```

### Benefits of Simplified Approach

- **No Duplicate Data**: Eliminates the need to send the same data twice
- **Consistency**: Report data is guaranteed to match appointment data
- **Simplicity**: Only one additional field (`create_report`) needed
- **Maintainability**: Changes to appointment data automatically reflect in reports

### Creating Appointment Without Report

To create an appointment without a report, simply omit the `create_report` field or set it to `false`:

```json
POST /api/appointments
{
    "date": "2024-01-15",
    "time_slot": "10:00",
    "patient_name": "John Doe",
    "contact_number": "1234567890",
    "agent_id": 1,
    "doctor_id": 1,
    "procedure_id": 1,
    "category_id": 1,
    "department_id": 1,
    "source_id": 1,
    "amount": 1000.00
}
```

## Error Handling

- If report creation fails, the appointment will still be created successfully
- Report creation errors are logged but do not affect the appointment creation process
- Validation errors for report fields will prevent the entire request from succeeding

## Examples

### Basic Report Creation

```json
{
    "date": "2024-01-15",
    "time_slot": "10:00",
    "patient_name": "Jane Smith",
    "contact_number": "0987654321",
    "agent_id": 2,
    "doctor_id": 2,
    "procedure_id": 2,
    "category_id": 2,
    "department_id": 2,
    "source_id": 2,
    "create_report": true
}
```

### Report with Complete Appointment Data

```json
{
    "date": "2024-01-15",
    "time_slot": "14:00",
    "patient_name": "Bob Johnson",
    "contact_number": "5555555555",
    "agent_id": 3,
    "doctor_id": 3,
    "procedure_id": 3,
    "category_id": 3,
    "department_id": 3,
    "source_id": 3,
    "amount": 1500.00,
    "payment_mode": "credit_card",
    "notes": "Patient requires follow-up in 2 weeks",
    "mr_number": "MR789012",
    "remarks_1_id": 2,
    "remarks_2_id": 2,
    "status_id": 2,
    "create_report": true
}
```

This will create both an appointment and a report where:
- The report will have the same amount (1500.00), payment method (credit_card), and notes
- The report will be generated by the same agent (agent_id: 3)
- All other appointment data will be automatically copied to the report
